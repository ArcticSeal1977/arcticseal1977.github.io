<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‚™å“ä½ç½®æŸ¥è©¢ç³»çµ± (Photo & Link Ver)</title>
    
    <!-- 1. å¼•å…¥æ ¸å¿ƒå‡½å¼åº« -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2563eb">

    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        select {
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
        input::placeholder {
            color: #9ca3af; 
        }
        /* é€£çµæ¨£å¼ */
        .external-link-btn {
            background: linear-gradient(to right, #3b82f6, #2563eb);
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ==========================================
        // ğŸ”§ è¨­å®šå€
        // ==========================================
        
        // è«‹å¡«å…¥ Google Sheet ç¶²å€
        const USER_PROVIDED_URL = "https://docs.google.com/spreadsheets/d/1gfLaPWDxW5NOW-mMi_Z1_j-TMh7PSTnC14XsLRMkI6U/edit?usp=sharing"; 
        
        // å‚™ç”¨è³‡æ–™ (æ›´æ–°åŒ…å«ç…§ç‰‡ã€å‚™è¨»ã€å¤–éƒ¨é€£çµ)
        const FALLBACK_DB = [
            {
                id: 101, system: "ITè¨­å‚™", subsystem: "ç¶²è·¯", category: "äº¤æ›å™¨", itemType: "L2 Switch",
                itemName: "Cisco Catalyst 2960-X (ç¯„ä¾‹)", partNumber: "WS-C2960X-24TS-L", serialNumber: "FOC1822Y0X1",
                spec: "24 Port GigE", quantity: 2, unit: "å°", lastMoveDate: "2025-11-20",
                locationCode: "N-A-02-WH-R05-A1", area: "åŒ—å€", building: "Aæ£Ÿ", floor: "2F", office: "å€‰å„²å€", rack: "R-05", bin: "A1",
                // æ–°å¢æ¬„ä½
                notes: "âš ï¸ æ³¨æ„ï¼šæ­¤è¨­å‚™å·²éä¿å›ºï¼Œåƒ…ä¾›æ¸¬è©¦ç’°å¢ƒä½¿ç”¨ã€‚",
                externalLink: "https://www.cisco.com/c/en/us/support/switches/catalyst-2960-x-series-switches/series.html",
                images: {
                    item: "https://placehold.co/600x400/2563eb/ffffff?text=Cisco+Switch+å¯¦é«”ç…§", // ç‰©å“ç…§ç‰‡
                    bin: "https://placehold.co/600x400/e2e8f0/1e293b?text=å„²ä½:A1+ç‰¹å¯«",
                    office: "https://placehold.co/600x400/f1f5f9/475569?text=å€‰å„²å€+å¹³é¢",
                    floor: "https://placehold.co/600x400/f8fafc/64748b?text=2F+æ¨“å±¤"
                }
            }
        ];

        // ğŸ› ï¸ è¼”åŠ©å‡½å¼ï¼šè‡ªå‹•ä¿®æ­£ Google Sheet ç¶²å€
        const getFixedCsvUrl = (url) => {
            if (!url) return '';
            if (url.includes('output=csv') || url.includes('tqx=out:csv')) return url;
            const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            if (match && match[1]) {
                return `https://docs.google.com/spreadsheets/d/${match[1]}/export?format=csv`;
            }
            return url;
        };

        // ==========================================
        // ğŸ§© å­å…ƒä»¶
        // ==========================================

        const LocationBreadcrumbs = ({ item }) => (
            <div className="flex flex-wrap items-center gap-1 text-sm text-gray-600 mb-3 bg-white p-3 rounded-lg shadow-sm border border-gray-100">
                <span className="font-semibold text-blue-600"><i className="fas fa-map-marker-alt mr-1"></i>{item.locationCode || 'N/A'}</span>
                <div className="w-full h-px bg-gray-100 my-1"></div>
                <div className="flex items-center text-xs text-gray-500 space-x-1">
                    <span>{item.area}</span><i className="fas fa-chevron-right text-[10px]"></i>
                    <span>{item.building}</span><i className="fas fa-chevron-right text-[10px]"></i>
                    <span>{item.floor}</span><i className="fas fa-chevron-right text-[10px]"></i>
                    <span>{item.office}</span><i className="fas fa-chevron-right text-[10px]"></i>
                    <span className="font-bold text-gray-700">{item.rack}-{item.bin}</span>
                </div>
            </div>
        );

        const DetailPage = ({ item, onBack }) => {
            // é è¨­é¡¯ç¤º 'item' (ç‰©å“ç…§ç‰‡)
            const [activeTab, setActiveTab] = useState('item');
            const images = item.images || {};

            return (
                <div className="min-h-screen bg-gray-50 pb-24 animate-fade-in">
                    {/* Header */}
                    <div className="sticky top-0 z-20 bg-white shadow-sm px-4 py-3 flex items-center gap-3">
                        <button onClick={onBack} className="p-2 text-gray-600 active:bg-gray-100 rounded-full">
                            <i className="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div className="flex-1 truncate">
                            <h1 className="text-lg font-bold text-gray-800 truncate">{item.itemName}</h1>
                            <p className="text-xs text-gray-500">{item.serialNumber}</p>
                        </div>
                        <div className={`px-3 py-1 rounded-full text-xs font-bold ${item.quantity > 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {item.quantity > 0 ? `${item.quantity} ${item.unit}` : 'ç¼ºè²¨'}
                        </div>
                    </div>

                    <div className="p-4 space-y-4">
                        
                        {/* 1. åœ–ç‰‡å€å¡Š (æ–°å¢ç‰©å“ç…§ç‰‡ Tab) */}
                        <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
                            <div className="flex border-b border-gray-100 overflow-x-auto hide-scrollbar">
                                {[
                                    { id: 'item', label: 'ç‰©å“ç…§ç‰‡', icon: 'fa-camera' }, // NEW
                                    { id: 'bin', label: 'å„²ä½ç¤ºæ„', icon: 'fa-box' },
                                    { id: 'office', label: 'è¾¦å…¬å®¤', icon: 'fa-door-open' },
                                    { id: 'floor', label: 'æ¨“å±¤åœ–', icon: 'fa-building' }
                                ].map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                                        className={`flex-1 min-w-[80px] py-3 text-xs font-medium flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 transition-colors
                                            ${activeTab === tab.id ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-gray-500 hover:text-gray-700'}`}>
                                        <i className={`fas ${tab.icon}`}></i>{tab.label}
                                    </button>
                                ))}
                            </div>
                            <div className="relative bg-gray-900 aspect-video flex items-center justify-center group">
                                {images[activeTab] ? (
                                    <img src={images[activeTab]} alt={activeTab} className="w-full h-full object-contain" />
                                ) : (
                                    <div className="flex flex-col items-center text-gray-500 text-sm">
                                        <i className="fas fa-image-slash text-2xl mb-2 opacity-50"></i>
                                        <span>ç„¡åœ–ç‰‡è³‡æ–™</span>
                                    </div>
                                )}
                                {/* æ”¾å¤§æç¤º */}
                                {images[activeTab] && <div className="absolute bottom-2 right-2 bg-black/60 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">å¯é•·æŒ‰å„²å­˜</div>}
                            </div>
                        </div>

                        {/* 2. ä½ç½®éºµåŒ…å±‘ */}
                        <LocationBreadcrumbs item={item} />

                        {/* 3. ç‰©å“è©³æƒ… (æ–°å¢å‚™è¨»èˆ‡å¤–éƒ¨é€£çµ) */}
                        <div className="bg-white rounded-xl shadow-sm p-4 border border-gray-200">
                            <h3 className="text-sm font-bold text-gray-800 mb-3 border-l-4 border-blue-500 pl-2">ç‰©å“è©³æƒ…</h3>
                            <div className="space-y-3 text-sm">
                                <div className="flex justify-between border-b border-gray-50 pb-2"><span className="text-gray-500">ç³»çµ±åˆ†é¡</span><span className="text-gray-800">{item.system} / {item.subsystem}</span></div>
                                <div className="flex justify-between border-b border-gray-50 pb-2"><span className="text-gray-500">é¡åˆ¥ / å“é …</span><span className="text-gray-800">{item.category} / {item.itemType}</span></div>
                                <div className="flex justify-between border-b border-gray-50 pb-2"><span className="text-gray-500">æ–™è™Ÿ (P/N)</span><span className="text-gray-800 font-mono">{item.partNumber}</span></div>
                                <div className="flex justify-between border-b border-gray-50 pb-2"><span className="text-gray-500">è¦æ ¼</span><span className="text-gray-800 text-right max-w-[60%]">{item.spec}</span></div>
                                <div className="flex justify-between pt-1"><span className="text-gray-500">æœ€å¾Œç•°å‹•</span><span className="text-gray-800 font-bold">{item.lastMoveDate}</span></div>
                            </div>

                            {/* æ–°å¢ï¼šå‚™è¨»æ¬„ä½ */}
                            {item.notes && (
                                <div className="mt-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3">
                                    <div className="text-xs text-yellow-700 font-bold mb-1"><i className="fas fa-sticky-note mr-1"></i>å‚™è¨»</div>
                                    <p className="text-sm text-gray-700">{item.notes}</p>
                                </div>
                            )}

                            {/* æ–°å¢ï¼šå¤–éƒ¨è³‡æ–™é€£çµ */}
                            {item.externalLink && (
                                <a href={item.externalLink} target="_blank" rel="noopener noreferrer" 
                                   className="mt-4 flex items-center justify-between w-full external-link-btn text-white p-3 rounded-lg shadow hover:opacity-90 transition-opacity">
                                    <span className="font-bold text-sm"><i className="fas fa-external-link-alt mr-2"></i>æŸ¥çœ‹å¤–éƒ¨è³‡æ–™ / æ‰‹å†Š</span>
                                    <i className="fas fa-chevron-right text-xs"></i>
                                </a>
                            )}
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 safe-area-bottom flex gap-3 shadow-lg z-30">
                        <button className="flex-1 bg-white border border-blue-600 text-blue-600 py-2.5 rounded-lg font-bold active:bg-blue-50"><i className="fas fa-clipboard-check mr-2"></i>ç›¤é»</button>
                        <button className="flex-1 bg-blue-600 text-white py-2.5 rounded-lg font-bold shadow-lg active:scale-[0.98] transition-transform"><i className="fas fa-dolly mr-2"></i>å‡ºåº«</button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // ğŸ” é¦–é  (åˆ—è¡¨ç¸®åœ–é‚è¼¯æ›´æ–° + å®Œæ•´éšå±¤é¸å–®ä¿®å¾©)
        // ==========================================
        const HomePage = ({ data, onSelectItem, loading, errorMsg }) => {
            const [query, setQuery] = useState('');
            const [filters, setFilters] = useState({
                area: 'All', system: 'All', subsystem: 'All', category: 'All', itemType: 'All', itemName: 'All'
            });

            // è¼”åŠ©å‡½å¼ï¼šå–å¾—å”¯ä¸€é¸é …
            const getUniqueOptions = (dataset, key) => {
                if(!dataset) return ['All'];
                const validValues = dataset.map(d => d[key]).filter(val => val !== undefined && val !== null && val !== "");
                return ['All', ...new Set(validValues)];
            };

            // =================================================
            // âš¡ï¸ éšå±¤å¼è³‡æ–™éæ¿¾èˆ‡é¸é …ç”Ÿæˆ (Cascade Logic)
            // =================================================

            // 1. è¨ˆç®—å„å±¤ç´šçš„å¯ç”¨è³‡æ–™ (ç”¨æ–¼ç”Ÿæˆé¸é …)
            // Area -> System -> Subsystem -> Category -> ItemType -> ItemName
            const dataLevel1 = useMemo(() => filters.area === 'All' ? data : data.filter(d => d.area === filters.area), [data, filters.area]);
            const dataLevel2 = useMemo(() => filters.system === 'All' ? dataLevel1 : dataLevel1.filter(d => d.system === filters.system), [dataLevel1, filters.system]);
            const dataLevel3 = useMemo(() => filters.subsystem === 'All' ? dataLevel2 : dataLevel2.filter(d => d.subsystem === filters.subsystem), [dataLevel2, filters.subsystem]);
            const dataLevel4 = useMemo(() => filters.category === 'All' ? dataLevel3 : dataLevel3.filter(d => d.category === filters.category), [dataLevel3, filters.category]);
            const dataLevel5 = useMemo(() => filters.itemType === 'All' ? dataLevel4 : dataLevel4.filter(d => d.itemType === filters.itemType), [dataLevel4, filters.itemType]);
            
            // 2. åŸºæ–¼éæ¿¾å¾Œçš„è³‡æ–™ç”Ÿæˆé¸é …
            const areaOptions = useMemo(() => getUniqueOptions(data, 'area'), [data]);
            const systemOptions = useMemo(() => getUniqueOptions(dataLevel1, 'system'), [dataLevel1]);
            const subsystemOptions = useMemo(() => getUniqueOptions(dataLevel2, 'subsystem'), [dataLevel2]);
            const categoryOptions = useMemo(() => getUniqueOptions(dataLevel3, 'category'), [dataLevel3]);
            const itemTypeOptions = useMemo(() => getUniqueOptions(dataLevel4, 'itemType'), [dataLevel4]);
            const itemNameOptions = useMemo(() => getUniqueOptions(dataLevel5, 'itemName'), [dataLevel5]);

            // 3. æœ€çµ‚åˆ—è¡¨éæ¿¾ (åŒ…å« ItemName + æ–‡å­—æœå°‹)
            const filteredData = useMemo(() => {
                let d = filters.itemName === 'All' ? dataLevel5 : dataLevel5.filter(d => d.itemName === filters.itemName);

                // Text Search
                if (query.trim()) {
                    const lowerQ = query.toLowerCase();
                    d = d.filter(item => 
                        (item.itemName || '').toLowerCase().includes(lowerQ) || 
                        (item.serialNumber || '').toLowerCase().includes(lowerQ) ||
                        (item.locationCode || '').toLowerCase().includes(lowerQ)
                    );
                }
                return d;
            }, [dataLevel5, filters.itemName, query]);

            // 4. è™•ç†ç¯©é¸è®Šæ›´ (è‡ªå‹•é‡ç½®ä¸‹å±¤)
            const handleFilterChange = (key, value) => {
                const newFilters = { ...filters, [key]: value };
                
                // Cascade Reset Logic
                if (key === 'area') {
                    newFilters.system='All'; newFilters.subsystem='All'; newFilters.category='All'; newFilters.itemType='All'; newFilters.itemName='All';
                } else if (key === 'system') {
                    newFilters.subsystem='All'; newFilters.category='All'; newFilters.itemType='All'; newFilters.itemName='All';
                } else if (key === 'subsystem') {
                    newFilters.category='All'; newFilters.itemType='All'; newFilters.itemName='All';
                } else if (key === 'category') {
                    newFilters.itemType='All'; newFilters.itemName='All';
                } else if (key === 'itemType') {
                    newFilters.itemName='All';
                }
                
                setFilters(newFilters);
            };

            const FilterSelect = ({ label, val, options, onChange, disabled }) => (
                <div className="relative min-w-[45%] flex-1">
                    <select 
                        value={val} 
                        onChange={(e) => onChange(e.target.value)}
                        disabled={disabled || options.length <= 1}
                        className={`w-full appearance-none border rounded-lg py-2 pl-3 pr-8 text-sm focus:outline-none transition-colors
                            ${val !== 'All' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-200'}
                            ${(disabled || options.length <= 1) ? 'opacity-50 cursor-not-allowed' : ''}
                        `}
                        style={val !== 'All' ? {} : {backgroundImage: `url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='gray' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e")`}}
                    >
                        <option value="All">{label} (å…¨)</option>
                        {options.filter(opt => opt !== 'All').map(opt => <option key={opt} value={opt}>{opt}</option>)}
                    </select>
                    <i className={`fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-xs pointer-events-none ${val !== 'All' ? 'text-blue-200' : 'text-gray-400'}`}></i>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-blue-600 px-4 pt-12 pb-6 rounded-b-[2rem] shadow-lg relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                            <i className="fas fa-boxes text-9xl absolute -right-10 -top-10 text-white"></i>
                        </div>
                        <div className="relative z-10">
                            <h1 className="text-white text-2xl font-bold mb-1">
                                å‚™å“æŸ¥è©¢ç³»çµ± 
                                {loading && <span className="text-xs bg-blue-500 px-2 py-1 rounded ml-2 animate-pulse">æ›´æ–°ä¸­...</span>}
                            </h1>
                            
                            <div className="bg-white rounded-xl shadow-lg flex items-center p-3 mb-4">
                                <i className="fas fa-search text-gray-400 ml-2"></i>
                                <input type="text" className="flex-1 ml-3 outline-none text-gray-700 placeholder-gray-400" placeholder="å¿«é€Ÿæœå°‹åºè™Ÿã€ç·¨è™Ÿ..." value={query} onChange={e => setQuery(e.target.value)} />
                                {query && <button onClick={() => setQuery('')} className="text-gray-400 p-1"><i className="fas fa-times-circle"></i></button>}
                            </div>

                            {errorMsg && (
                                <div className="bg-red-100 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-xs mb-2">
                                    <i className="fas fa-exclamation-circle mr-1"></i> {errorMsg}
                                </div>
                            )}

                            {/* å®Œæ•´éšå±¤éæ¿¾å™¨ */}
                            <div className="flex flex-col gap-2">
                                {/* Row 1: å€åŸŸ */}
                                <FilterSelect label="ğŸ“ å€åŸŸ" val={filters.area} options={areaOptions} onChange={(v)=>handleFilterChange('area', v)} />
                                
                                {/* Row 2: ç³»çµ± | å­ç³»çµ± */}
                                <div className="flex gap-2">
                                    <FilterSelect label="ç³»çµ±" val={filters.system} options={systemOptions} onChange={(v)=>handleFilterChange('system', v)} />
                                    <FilterSelect label="å­ç³»çµ±" val={filters.subsystem} options={subsystemOptions} onChange={(v)=>handleFilterChange('subsystem', v)} disabled={filters.system === 'All'} />
                                </div>
                                
                                {/* Row 3: é¡åˆ¥ | å“é … */}
                                <div className="flex gap-2">
                                    <FilterSelect label="é¡åˆ¥" val={filters.category} options={categoryOptions} onChange={(v)=>handleFilterChange('category', v)} disabled={filters.subsystem === 'All'} />
                                    <FilterSelect label="å“é …" val={filters.itemType} options={itemTypeOptions} onChange={(v)=>handleFilterChange('itemType', v)} disabled={filters.category === 'All'} />
                                </div>

                                {/* Row 4: å“å */}
                                <FilterSelect label="å“å" val={filters.itemName} options={itemNameOptions} onChange={(v)=>handleFilterChange('itemName', v)} disabled={filters.itemType === 'All'} />
                            </div>
                        </div>
                    </div>

                    <div className="p-4 pb-20">
                        <div className="flex justify-between items-end mb-3">
                            <h2 className="text-gray-800 font-bold text-lg">æŸ¥è©¢çµæœ</h2>
                            <span className="text-xs text-gray-500 bg-gray-200 px-2 py-1 rounded-full">{filteredData.length} ç­†</span>
                        </div>

                        <div className="space-y-3">
                            {filteredData.map((item, idx) => (
                                <div key={idx} onClick={() => onSelectItem(item)} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 active:scale-[0.99] transition-transform cursor-pointer flex gap-4">
                                    {/* ç¸®åœ–é‚è¼¯ï¼šå„ªå…ˆé¡¯ç¤º item photoï¼Œæ²’æœ‰å‰‡é¡¯ç¤º bin photo */}
                                    <div className="w-20 h-20 bg-gray-100 rounded-lg flex-shrink-0 overflow-hidden relative border border-gray-100">
                                        <img 
                                            src={item.images?.item || item.images?.bin || 'https://placehold.co/100x100?text=No+Image'} 
                                            className="w-full h-full object-cover" 
                                            alt="thumb" 
                                            onError={(e) => {e.target.src='https://placehold.co/100x100?text=Error'}}
                                        />
                                        {/* å¦‚æœæ˜¯ç‰©å“ç…§ç‰‡ï¼ŒåŠ å€‹å° icon æ¨™ç¤º */}
                                        {item.images?.item && <div className="absolute bottom-0 right-0 bg-blue-600 text-white text-[8px] px-1 rounded-tl">å¯¦é«”</div>}
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex justify-between items-start">
                                            <h3 className="font-bold text-gray-800 truncate text-sm mb-1">{item.itemName}</h3>
                                            {item.quantity <= 0 && <span className="bg-red-50 text-red-600 text-[10px] px-1.5 py-0.5 rounded font-bold border border-red-100">ç¼ºè²¨</span>}
                                        </div>
                                        <p className="text-xs text-gray-500 mb-2">S/N: {item.serialNumber}</p>
                                        <div className="flex items-center gap-1 text-xs text-blue-600 bg-blue-50 w-fit px-2 py-1 rounded">
                                            <i className="fas fa-map-marker-alt"></i><span className="font-mono">{item.locationCode}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {filteredData.length === 0 && <div className="text-center py-10 text-gray-400"><i className="fas fa-inbox text-4xl mb-3"></i><p>æ‰¾ä¸åˆ°ç¬¦åˆçš„å‚™å“</p></div>}
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // ğŸš€ ä¸»ç¨‹å¼
        // ==========================================
        const App = () => {
            const [view, setView] = useState('home');
            const [selectedItem, setSelectedItem] = useState(null);
            const [dbData, setDbData] = useState(FALLBACK_DB);
            const [loading, setLoading] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');

            useEffect(() => {
                const targetUrl = getFixedCsvUrl(USER_PROVIDED_URL);

                if (targetUrl) {
                    setLoading(true);
                    Papa.parse(targetUrl, {
                        download: true,
                        header: true,
                        complete: (results) => {
                            if (results.data && results.data.length > 0) {
                                const parsedData = results.data
                                    .filter(row => row.itemName)
                                    .map(row => ({
                                        ...row,
                                        // æ˜ å°„æ–°æ¬„ä½ (æ”¯æ´ä¸­è‹±æ–‡æ¬„ä½åç¨±)
                                        notes: row.notes || row['å‚™è¨»'], 
                                        externalLink: row.external_link || row['externalLink'] || row['å¤–éƒ¨é€£çµ'] || row['å¤–éƒ¨è³‡æ–™é€£çµ'],
                                        images: {
                                            item: row.item_photo || row['ç‰©å“ç…§ç‰‡'], 
                                            bin: row.image_bin || row['å„²ä½ç¤ºæ„åœ–'],
                                            office: row.image_office || row['è¾¦å…¬å®¤å¹³é¢åœ–'],
                                            floor: row.image_floor || row['æ¨“å±¤å¹³é¢åœ–']
                                        }
                                    }));
                                setDbData(parsedData);
                                setErrorMsg('');
                            } else {
                                setErrorMsg('Google Sheet è®€å–æˆåŠŸä½†ç„¡è³‡æ–™ï¼Œè«‹æª¢æŸ¥æ¬„ä½åç¨±ã€‚');
                            }
                            setLoading(false);
                        },
                        error: (err) => {
                            console.error("CSV Fetch Error:", err);
                            setLoading(false);
                            setErrorMsg('è®€å–å¤±æ•—ï¼Œé¡¯ç¤ºç¯„ä¾‹è³‡æ–™ã€‚è«‹ç¢ºèª Google Sheet å·²ç™¼å¸ƒåˆ°ç¶²è·¯ã€‚');
                        }
                    });
                }
            }, []);

            const handleSelectItem = (item) => {
                setSelectedItem(item);
                setView('detail');
                window.scrollTo(0, 0);
            };

            const handleBack = () => {
                setView('home');
                setSelectedItem(null);
            };

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen shadow-2xl overflow-hidden">
                    {view === 'home' ? (
                        <HomePage data={dbData} onSelectItem={handleSelectItem} loading={loading} errorMsg={errorMsg} />
                    ) : (
                        <DetailPage item={selectedItem} onBack={handleBack} />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>